# 网络协议

## 游戏基本流程

**9路棋盘**

1. 客户端连接服务端
2. 客户端向服务端发送 `READY_OP` 表申请对局
3. 服务端向客户端发送 `READY_OP` 或 `REJECT_OP` 表同意或拒绝对局
4. 双方准备好后，执黑方发送第一步棋 `MOVE_OP`，比赛开始
5. 双方轮流发送 `MOVE_OP`
6. 当一方认输、超时或违规，比赛结束
7. 胜方向败方发送 `GG_OP` 确认
8. 败方回复 `GG_OP` 确认
9. 任意一方发送 `LEAVE_OP` 后，断开连接（在这之前保持连接）或 任意一方发送 `READY_OP` 请求再来一局，回到 **2.**

## 网络协议

一个完整的请求包含一个操作符 `OP` 以及至多两个数据段 `data1` 和 `data2`。操作符指定了当前请求需要执行的操作，数据段则在此基础上给出了一些额外信息。

下面给出本次作业中可能用到的所有请求及其处理行为，"空"代表接收方可以不处理，发送方也可以置这个数据段为空。

### `READY_OP`

即是准备，也是申请。**请求对局方**要向对方发送自己希望执的颜色，对方同样回应 `READY_OP` 表示对局成立。

1. 建立连接成功时，客户端是请求对局方
2. 对局结束后，想再来一局的是请求对局方

- `data1`: 己方用户名
- `data2`: 己方执棋颜色（回应方可以不发）

**用户名**：只能包含常见汉字、英文字母、下划线、短横线，不得包含空格、换行符、制表符等分隔符。
**颜色编码**：黑则`"b"`，白则`"w"`

### `REJECT_OP`

拒绝对局申请，向对方发送 `REJECT_OP`。之后可以发送 `LEAVE_OP` 离开，也可以交流信息后重新发 `READY_OP`，但不能直接离开。

- `data1`: 己方用户名
- `data2`: 拒绝理由（空）

### `MOVE_OP`

决定如何行棋后，向对方发送 `MOVE_OP`

- `data1`：落子点坐标
- `data2`：空

坐标编码：用 `A1`，`I9` 这种表示，坐标轴方向同 [nogo.md](../../guidance/nogo/nogo.md) 中所示

### `GIVEUP_OP`

认输，替代 `MOVE_UP`，向对方发送 `GIVEUP_OP`

- `data1`：空
- `data2`：空

> 无处落子时及时认输才是君子之道

### `GG_OP`

`GG_OP` 并不是一个 `OP`，而是一组指定获胜原因的 `OP`。胜者先发，败者回复相同操作表示确认。

- `TIMEOUT_END_OP`: 一方超时
- `SUICIDE_END_OP`: 一方落子非法：即自杀，重复落子或**吃了对方**
- `GIVEUP_END_OP`: 一方认输

> 对方对局中突然 `LEAVE_OP` 则不需要向对方发送任何信息，房间直接关闭。

他们的数据段含义相同

- `data1`：己方用户名（空）
- `data2`：问候语（空）

### `LEAVE_OP`

任何时候，发送 `LEAVE_OP` 说明即将立刻断开连接。

- `data1`：空
- `data2`：空

> 断开前都先发 `LEAVE_OP`，以区分意外断开

### `CHAT_OP`

只要保持连接，就可以发送 `CHAT_OP` 聊天或交换信息。

- `data1`：信息内容
- `data2`: 空

> 上面所提到的特殊编码（颜色，坐标）均不能莫名其妙包含空格，制表符，换行等无关字符，保证编码严格统一。